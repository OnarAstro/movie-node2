// Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙˆØ¯ÙŠÙ„ Movie Ù…Ù† Ù…Ù„Ù Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª (Schemas)
const Movie = require("../Schemas/movie");

// Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙÙ„Ø§Ù… Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
exports.getAllmovies = async (req, res) => {
  try {
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙÙ„Ø§Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… find()
    const movies = await Movie.find();
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ø³ØªØ¬Ø§Ø¨Ø© Ø¨ØµÙŠØºØ© JSON
    res.json(movies);
  } catch (error) {
    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙÙŠ Ø­Ø§Ù„Ø© Ø­Ø¯ÙˆØ« Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
    res.status(500).json({ message: error.message });
  }
};

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© ÙÙŠÙ„Ù… Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
exports.addMovie = async (req, res) => {
  // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Movie Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ø·Ù„Ø¨
  const newMovie = new Movie(req.body);
  try {
    // Ø­ÙØ¸ Ø§Ù„ÙÙŠÙ„Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    await newMovie.save();
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø¹ ÙƒÙˆØ¯ 201 (Created)
    res.status(201).json(newMovie);
  } catch (error) {
    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©
    res.status(400).json({ message: error.message });
  }
};

// Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠÙ„Ù… Ù…Ø¹ÙŠÙ† Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø£Ø³ØªØ®Ø¯Ø§Ù…  title
exports.getmovieByName = async (req, res) => {
  try {
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙÙŠÙ„Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… title
    const movie = await Movie.findOne({ title: req.params.title });
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ø³ØªØ¬Ø§Ø¨Ø©
    res.json(movie);
  } catch (error) {
    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø§Ø¡ ÙÙŠ Ø­Ø§Ù„Ø© Ø­Ø¯ÙˆØ« Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
    res.status(500).json({ message: error.message });
  }
};

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠÙ„Ù… Ù…Ø¹ÙŠÙ†
exports.updateMovie = async (req, res) => {
  try {
    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠÙ„Ù… Ø¨Ø­Ø³Ø¨ ID ÙˆØ¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
    const updatedMovie = await Movie.findByIdAndUpdate(
      req.params.id,
      req.body,
      {
        new: true, // ØªØ¶Ù…Ù† Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      }
    );
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© ÙƒØ§Ø³ØªØ¬Ø§Ø¨Ø©
    res.json(updatedMovie);
  } catch (error) {
    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
    res.status(400).json({ message: error.message });
  }
};

// Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù ÙÙŠÙ„Ù… Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
exports.deleteMovie = async (req, res) => {
  try {
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙÙŠÙ„Ù… ÙˆØ­Ø°ÙÙ‡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ID
    await Movie.findByIdAndDelete(req.params.id);
    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­ Ø§Ù„Ø­Ø°Ù
    res.json({ message: "Movie deleted" });
  } catch (error) {
    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø°Ù
    res.status(500).json({ message: error.message });
  }
};

exports.search = async (req, res) => {
  try {
    const { query } = req.query;
    if (!query || query.length < 2) return res.json([]);
    // console.log("ðŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†:", query);

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø¥Ù„Ù‰ Regex Ø¨Ø³ÙŠØ· Ø¨Ø¯ÙˆÙ† `(?=.*word)`
    const regex = new RegExp(query, "i"); 

    const movies = await Movie.find({
      title: { $regex: regex }, // Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒÙ„Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ø¬Ù…Ù„Ø©
    })
      .limit(10)
      .select("title poster _id");

    res.json(movies);
  } catch (error) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:", error);
    res.status(500).json({ message: "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±" });
  }
};
